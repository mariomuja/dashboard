<div class="scheduler-container">
  <div class="scheduler-header">
    <div class="header-content">
      <h1>ğŸ“§ Email Reports</h1>
      <p>Schedule automated dashboard reports</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="goBack()">
        â† Back to Admin
      </button>
      <button class="btn-primary" (click)="toggleCreateForm()">
        {{ showCreateForm ? 'âœ• Cancel' : 'â• New Schedule' }}
      </button>
    </div>
  </div>

  <div class="scheduler-content">
    <!-- Test Email Section -->
    <div class="test-section">
      <h2>ğŸ§ª Test Email Service</h2>
      <p>Send a test email to verify configuration</p>
      <div class="test-form">
        <input 
          type="email" 
          [(ngModel)]="testEmailRecipient"
          placeholder="Enter email address"
          class="email-input">
        <button 
          class="btn-primary"
          (click)="sendTestEmail()"
          [disabled]="isSending">
          {{ isSending ? 'Sending...' : 'ğŸ“¤ Send Test' }}
        </button>
      </div>
    </div>

    <!-- Create Schedule Form -->
    <div class="create-form" *ngIf="showCreateForm">
      <h2>Create Email Schedule</h2>
      
      <div class="form-group">
        <label>Frequency</label>
        <select [(ngModel)]="newSchedule.frequency" class="form-select">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly (Monday)</option>
          <option value="monthly">Monthly (1st day)</option>
        </select>
      </div>

      <div class="form-group">
        <label>Time</label>
        <input 
          type="time" 
          [(ngModel)]="newSchedule.time"
          class="form-input">
      </div>

      <div class="form-group">
        <label>Report Type</label>
        <select [(ngModel)]="newSchedule.reportType" class="form-select">
          <option value="summary">Summary Report</option>
          <option value="detailed">Detailed Report</option>
        </select>
      </div>

      <div class="form-group">
        <label>Recipients</label>
        <div class="recipient-input">
          <input 
            type="email" 
            [(ngModel)]="recipientInput"
            (keyup.enter)="addRecipient()"
            placeholder="email@example.com"
            class="form-input">
          <button class="btn-add" (click)="addRecipient()">Add</button>
        </div>
        <div class="recipients-list" *ngIf="newSchedule.recipients.length > 0">
          <div *ngFor="let recipient of newSchedule.recipients" class="recipient-tag">
            {{ recipient }}
            <button class="remove-btn" (click)="removeRecipient(recipient)">Ã—</button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn-secondary" (click)="toggleCreateForm()">Cancel</button>
        <button class="btn-primary" (click)="createSchedule()">Create Schedule</button>
      </div>
    </div>

    <!-- Schedules List -->
    <div class="schedules-section">
      <h2>ğŸ“… Active Schedules</h2>
      
      <div class="empty-state" *ngIf="schedules.length === 0 && !showCreateForm">
        <div class="empty-icon">ğŸ“­</div>
        <h3>No Schedules Yet</h3>
        <p>Create your first email schedule to get automated reports</p>
      </div>

      <div class="schedules-grid" *ngIf="schedules.length > 0">
        <div *ngFor="let schedule of schedules" class="schedule-card">
          <div class="schedule-header">
            <div class="schedule-title">
              <span class="frequency-badge">{{ schedule.frequency }}</span>
              <span class="time-badge">{{ schedule.time }}</span>
            </div>
            <button class="btn-delete" (click)="deleteSchedule(schedule.id!)">
              ğŸ—‘ï¸
            </button>
          </div>
          <div class="schedule-details">
            <div class="detail-row">
              <strong>Report Type:</strong> {{ schedule.reportType }}
            </div>
            <div class="detail-row">
              <strong>Recipients:</strong> {{ schedule.recipients.length }}
            </div>
            <div class="recipients-preview">
              {{ schedule.recipients.join(', ') }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="info-section">
      <h3>â„¹ï¸ Setup Instructions</h3>
      <ol>
        <li>Start the email service: <code>node server-email.js</code></li>
        <li>Configure SMTP settings in environment variables</li>
        <li>Create a schedule with frequency and recipients</li>
        <li>Reports will be sent automatically at the specified time</li>
      </ol>
      <p><strong>Note:</strong> Email service runs on port 3002 by default.</p>
    </div>
  </div>
</div>

