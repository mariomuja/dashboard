<div class="modal-overlay" (click)="cancel()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <span>ğŸ¤–</span>
        Configure AI Insights
      </h2>
      <button class="close-btn" (click)="cancel()">âœ•</button>
    </div>

    <div class="modal-body">
      <!-- Enable/Disable -->
      <section class="form-section">
        <div class="form-group checkbox-group">
          <label>
            <input 
              type="checkbox" 
              [(ngModel)]="config.enabled">
            <strong>Enable AI Insights</strong>
          </label>
          <small>Generate automatic insights based on KPI data</small>
        </div>
      </section>

      <!-- Insight Types -->
      <section class="form-section">
        <h3>ğŸ“Š Insight Types</h3>
        
        <div class="insight-types">
          <div class="form-group checkbox-group">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="config.insightTypes!.trendAnalysis">
              ğŸ“ˆ Trend Analysis
            </label>
            <small>Analyze trends and patterns in KPI data</small>
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="config.insightTypes!.anomalyDetection">
              âš ï¸ Anomaly Detection
            </label>
            <small>Detect unusual changes or outliers</small>
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="config.insightTypes!.recommendations">
              ğŸ’¡ Recommendations
            </label>
            <small>Provide actionable recommendations</small>
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="config.insightTypes!.predictions">
              ğŸ”® Predictions
            </label>
            <small>Forecast future trends (experimental)</small>
          </div>
        </div>
      </section>

      <!-- Thresholds -->
      <section class="form-section">
        <h3>âš™ï¸ Detection Thresholds</h3>
        
        <div class="form-group">
          <label>Significant Change Threshold (%)</label>
          <input 
            type="number" 
            [(ngModel)]="config.thresholds!.significantChange"
            min="1"
            max="100"
            class="form-input">
          <small>Minimum % change to generate an insight (default: 5%)</small>
        </div>

        <div class="form-group">
          <label>Warning Threshold (%)</label>
          <input 
            type="number" 
            [(ngModel)]="config.thresholds!.warningThreshold"
            min="1"
            max="100"
            class="form-input">
          <small>% change to trigger warning insights (default: 10%)</small>
        </div>

        <div class="form-group">
          <label>Critical Threshold (%)</label>
          <input 
            type="number" 
            [(ngModel)]="config.thresholds!.criticalThreshold"
            min="1"
            max="100"
            class="form-input">
          <small>% change to trigger critical alerts (default: 20%)</small>
        </div>
      </section>

      <!-- Custom Messages -->
      <section class="form-section">
        <h3>ğŸ’¬ Custom Messages (Optional)</h3>
        
        <div class="form-group">
          <label>Positive Growth Message</label>
          <input 
            type="text" 
            [(ngModel)]="config.customMessages!.positiveGrowth"
            placeholder="e.g., Great job! {kpi} is up {change}%"
            class="form-input">
          <small>Use {`{kpi}`} and {`{change}`} as placeholders</small>
        </div>

        <div class="form-group">
          <label>Negative Growth Message</label>
          <input 
            type="text" 
            [(ngModel)]="config.customMessages!.negativeGrowth"
            placeholder="e.g., {kpi} has declined by {change}%"
            class="form-input">
        </div>

        <div class="form-group">
          <label>Stable Message</label>
          <input 
            type="text" 
            [(ngModel)]="config.customMessages!.stable"
            placeholder="e.g., {kpi} remains stable"
            class="form-input">
        </div>

        <div class="form-group">
          <label>Anomaly Message</label>
          <input 
            type="text" 
            [(ngModel)]="config.customMessages!.anomaly"
            placeholder="e.g., Unusual pattern detected in {kpi}"
            class="form-input">
        </div>
      </section>

      <!-- Refresh Interval -->
      <section class="form-section">
        <h3>ğŸ”„ Refresh Settings</h3>
        
        <div class="form-group">
          <label>Auto-Refresh Interval (minutes)</label>
          <input 
            type="number" 
            [(ngModel)]="config.refreshInterval"
            min="1"
            max="60"
            placeholder="5"
            class="form-input">
          <small>How often to regenerate insights (leave empty for manual only)</small>
        </div>
      </section>

      <div class="info-box">
        <strong>â„¹ï¸ How It Works:</strong>
        <p>AI Insights analyzes your KPI data to automatically generate observations like:</p>
        <ul>
          <li>"Total Revenue Remains Stable" - when changes are below significant threshold</li>
          <li>"Strong Growth in Active Users" - when positive changes exceed thresholds</li>
          <li>"Warning: Conversion Rate Declining" - when negative trends are detected</li>
        </ul>
        <p>Configure the thresholds above to control when insights are generated.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="mat-btn mat-btn-text" (click)="cancel()">
        Cancel
      </button>
      <button class="mat-btn mat-btn-filled" (click)="save()">
        ğŸ’¾ Save Configuration
      </button>
    </div>
  </div>
</div>
