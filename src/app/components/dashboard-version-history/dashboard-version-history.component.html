<div class="version-history-container">
  <!-- Header -->
  <header class="vh-header">
    <div class="header-content">
      <div class="header-title">
        <h1>ğŸ”„ Dashboard Version History</h1>
        <p>View, compare, and restore dashboard versions</p>
      </div>
      <div class="header-actions">
        <button class="mat-btn mat-btn-outlined" (click)="exportHistory()">
          <span>ğŸ“¤</span> Export History
        </button>
        <button class="mat-btn mat-btn-outlined" (click)="goToDashboard()">
          <span>ğŸ“Š</span> Dashboard
        </button>
        <button class="mat-btn mat-btn-text" (click)="goBack()">
          â† Back to Builder
        </button>
      </div>
    </div>
  </header>

  <!-- Statistics -->
  <div class="statistics-panel" *ngIf="statistics">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.totalVersions }}</div>
        <div class="stat-label">Total Versions</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“¦</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.averageWidgetCount }}</div>
        <div class="stat-label">Avg Widgets</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.oldestVersion ? formatDate(statistics.oldestVersion).split(',')[0] : 'N/A' }}</div>
        <div class="stat-label">First Version</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ·ï¸</div>
      <div class="stat-content">
        <div class="stat-value">{{ getTagCount() }}</div>
        <div class="stat-label">Unique Tags</div>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-panel">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        placeholder="ğŸ” Search versions..."
        class="search-input">
    </div>
    
    <select [(ngModel)]="filterTag" class="filter-select">
      <option value="">All Tags</option>
      <option *ngFor="let tag of allTags" [value]="tag">{{ tag }}</option>
    </select>

    <button 
      class="mat-btn mat-btn-outlined"
      [class.active]="showCompareMode"
      (click)="toggleCompareMode()">
      <span>ğŸ”€</span> {{ showCompareMode ? 'Exit Compare' : 'Compare Versions' }}
    </button>
  </div>

  <!-- Compare Mode Info -->
  <div class="compare-info" *ngIf="showCompareMode">
    <div class="compare-selection">
      <span *ngIf="!compareVersion1">ğŸ‘† Select first version to compare</span>
      <span *ngIf="compareVersion1 && !compareVersion2">
        Selected: <strong>v{{ compareVersion1.version }}</strong> - Select second version
      </span>
      <span *ngIf="compareVersion1 && compareVersion2">
        Comparing: <strong>v{{ compareVersion1.version }}</strong> vs <strong>v{{ compareVersion2.version }}</strong>
      </span>
    </div>
  </div>

  <!-- Comparison Results -->
  <div class="comparison-results" *ngIf="comparison">
    <h3>Comparison Results</h3>
    <div class="comparison-grid">
      <div class="comparison-card added">
        <div class="comparison-icon">â•</div>
        <div class="comparison-count">{{ comparison.added.length }}</div>
        <div class="comparison-label">Widgets Added</div>
      </div>
      <div class="comparison-card removed">
        <div class="comparison-icon">â–</div>
        <div class="comparison-count">{{ comparison.removed.length }}</div>
        <div class="comparison-label">Widgets Removed</div>
      </div>
      <div class="comparison-card modified">
        <div class="comparison-icon">ğŸ“</div>
        <div class="comparison-count">{{ comparison.modified.length }}</div>
        <div class="comparison-label">Widgets Modified</div>
      </div>
      <div class="comparison-card unchanged">
        <div class="comparison-icon">âœ“</div>
        <div class="comparison-count">{{ comparison.unchanged.length }}</div>
        <div class="comparison-label">Unchanged</div>
      </div>
    </div>
  </div>

  <!-- Version List -->
  <div class="versions-list">
    <div *ngIf="filteredVersions.length === 0" class="no-versions">
      <div class="no-versions-icon">ğŸ“­</div>
      <p>No versions found</p>
    </div>

    <div 
      *ngFor="let version of filteredVersions" 
      class="version-card"
      [class.active]="version.isActive"
      [class.selected]="selectedVersion?.id === version.id"
      [class.compare-selected]="compareVersion1?.id === version.id || compareVersion2?.id === version.id"
      (click)="showCompareMode ? selectForComparison(version) : selectVersion(version)">
      
      <!-- Version Header -->
      <div class="version-header">
        <div class="version-title">
          <span class="version-number">v{{ version.version }}</span>
          <span class="version-name">{{ version.name }}</span>
          <span class="version-badge active-badge" *ngIf="version.isActive">ACTIVE</span>
          <span 
            class="version-badge type-badge" 
            [style.background-color]="getChangeTypeColor(version.metadata.changeType)">
            {{ getChangeTypeIcon(version.metadata.changeType) }} {{ version.metadata.changeType }}
          </span>
        </div>
        <div class="version-actions" *ngIf="!showCompareMode">
          <button 
            class="icon-btn" 
            (click)="rollbackToVersion(version); $event.stopPropagation()"
            [disabled]="version.isActive"
            title="Rollback to this version">
            â®ï¸
          </button>
          <button 
            class="icon-btn" 
            (click)="addTag(version); $event.stopPropagation()"
            title="Add tag">
            ğŸ·ï¸
          </button>
          <button 
            class="icon-btn danger" 
            (click)="deleteVersion(version); $event.stopPropagation()"
            [disabled]="version.isActive"
            title="Delete version">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>

      <!-- Version Details -->
      <div class="version-details">
        <p class="version-description">{{ version.description }}</p>
        
        <div class="version-meta">
          <span class="meta-item">
            <span class="meta-icon">ğŸ‘¤</span>
            {{ version.createdBy }}
          </span>
          <span class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            {{ formatDate(version.createdAt) }}
          </span>
          <span class="meta-item">
            <span class="meta-icon">ğŸ“¦</span>
            {{ version.metadata.widgetCount }} widgets
          </span>
        </div>

        <!-- Changes Summary -->
        <div class="changes-summary" *ngIf="version.metadata.changesSummary.length > 0">
          <div class="changes-title">Changes:</div>
          <ul class="changes-list">
            <li *ngFor="let change of version.metadata.changesSummary">{{ change }}</li>
          </ul>
        </div>

        <!-- Tags -->
        <div class="version-tags" *ngIf="version.tags.length > 0">
          <span 
            *ngFor="let tag of version.tags" 
            class="tag"
            (click)="$event.stopPropagation()">
            {{ tag }}
            <span class="tag-remove" (click)="removeTag(version, tag); $event.stopPropagation()">Ã—</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
