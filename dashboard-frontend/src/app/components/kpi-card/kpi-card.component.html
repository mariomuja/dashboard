<div 
  class="kpi-card" 
  [@cardAnimation]
  role="article"
  [attr.aria-label]="kpi.title + ': ' + kpi.value"
  tabindex="0">
  <div class="kpi-header">
    <span class="kpi-icon" aria-hidden="true">{{ kpi.icon }}</span>
    <div class="kpi-header-right">
      <span 
        class="kpi-change" 
        [ngClass]="{
          'positive': kpi.trend === 'up',
          'negative': kpi.trend === 'down',
          'neutral': kpi.trend === 'stable'
        }"
        [attr.aria-label]="'Change: ' + (kpi.change > 0 ? 'up' : kpi.change < 0 ? 'down' : 'stable') + ' by ' + Math.abs(kpi.change) + ' percent'">
        <span class="change-arrow" aria-hidden="true">
          {{ kpi.trend === 'up' ? '↑' : kpi.trend === 'down' ? '↓' : '→' }}
        </span>
        {{ kpi.change > 0 ? '+' : '' }}{{ kpi.change }}%
      </span>
      <button 
        *ngIf="showEditButton && kpiConfigId"
        class="kpi-edit-btn"
        (click)="onEdit($event)"
        title="Edit KPI Configuration"
        aria-label="Edit KPI Configuration">
        ✏️
      </button>
    </div>
  </div>
  <div class="kpi-content">
    <h3 class="kpi-title">{{ kpi.title }}</h3>
    <p class="kpi-value" [style.color]="kpi.color">
      <ng-container *ngIf="kpi.numericValue !== undefined; else showFormatted">
        <span [appCountUp]="kpi.numericValue"></span>
        <span *ngIf="hasPrefix(kpi.value)">{{ getPrefix(kpi.value) }}</span>
        <span *ngIf="hasSuffix(kpi.value)">{{ getSuffix(kpi.value) }}</span>
      </ng-container>
      <ng-template #showFormatted>{{ kpi.value }}</ng-template>
    </p>
  </div>
</div>



