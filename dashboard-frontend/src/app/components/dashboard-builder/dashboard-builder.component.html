<div class="builder-container">
  <!-- Builder Header -->
  <div class="builder-header">
    <div class="header-content">
      <h1>ğŸ¨ Dashboard Builder</h1>
      <p>Drag, resize, and position widgets on the grid</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="toggleGridOverlay()">
        {{ showGridOverlay ? 'ğŸ‘ï¸ Hide Grid' : 'ğŸ‘ï¸ Show Grid' }}
      </button>
      <button class="btn-secondary" (click)="toggleTemplateSelector()">
        ğŸ“ Templates
      </button>
      <button class="btn-secondary" (click)="toggleWidgetPicker()">
        â• Add Widget
      </button>
      <button class="btn-secondary" (click)="saveVersionWithName()">
        ğŸ’¾ Save Version
      </button>
      <button class="btn-secondary" routerLink="/version-history">
        ğŸ”„ Version History
      </button>
      <button class="btn-secondary" (click)="resetToDefault()">
        ğŸ”„ Reset
      </button>
      <button class="btn-primary" routerLink="/">
        âœ“ Done
      </button>
    </div>
  </div>

  <!-- Template Selector -->
  <div class="template-selector" *ngIf="showTemplateSelector" [@slideDown]>
    <h3>Choose a Template</h3>
    <div class="templates-grid">
      <div *ngFor="let template of templates" 
           class="template-card"
           (click)="applyTemplate(template.id)">
        <div class="template-icon">{{ template.thumbnail }}</div>
        <h4>{{ template.name }}</h4>
        <p>{{ template.description }}</p>
      </div>
    </div>
  </div>

  <!-- Widget Picker -->
  <div class="widget-picker" *ngIf="showWidgetPicker" [@slideDown]>
    <h3>Add a Widget</h3>
    <div class="widgets-grid">
      <div *ngFor="let widget of availableWidgets"
           class="widget-option"
           (click)="addWidget(widget.type)">
        <div class="widget-icon">{{ widget.icon }}</div>
        <div class="widget-label">{{ widget.label }}</div>
      </div>
    </div>
  </div>

  <!-- Grid Info Banner -->
  <div class="info-banner">
    <span class="info-icon">â„¹ï¸</span>
    <span>Drag widgets to reposition. Drag corners and edges to resize. Grid: 12 columns Ã— {{ GRID_ROWS }} rows</span>
  </div>

  <!-- Grid Container -->
  <div class="grid-wrapper">
    <!-- Grid Overlay -->
    <div class="grid-overlay" *ngIf="showGridOverlay">
      <div class="grid-cell" *ngFor="let cell of [].constructor(GRID_COLUMNS * 10)"></div>
    </div>

    <!-- Widgets Grid -->
    <div class="grid-container">
      <div *ngFor="let widget of widgets"
           class="grid-widget"
           [class.hidden]="!widget.visible"
           [class.dragging]="draggingWidget === widget.id"
           [ngStyle]="getWidgetStyle(widget)"
           cdkDrag
           cdkDragBoundary=".grid-container"
           [cdkDragFreeDragPosition]="{x: 0, y: 0}"
           (cdkDragStarted)="onDragStarted(widget)"
           (cdkDragEnded)="onDragEnded($event, widget)">
        
        <!-- Widget Header -->
        <div class="widget-header" cdkDragHandle>
          <span class="drag-handle">â‹®â‹®</span>
          <span class="widget-title">{{ getWidgetLabel(widget.type) }}</span>
          <div class="widget-controls">
            <button class="control-btn" (click)="toggleWidget(widget.id)" title="Toggle visibility">
              {{ widget.visible ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
            <button class="control-btn danger" (click)="removeWidget(widget.id)" title="Remove widget">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>

        <!-- Widget Content Placeholder -->
        <div class="widget-content">
          <div class="widget-icon-large">{{ getWidgetIcon(widget.type) }}</div>
          <div class="widget-dimensions">
            {{ widget.size.width }}Ã—{{ widget.size.height }}
            <span class="grid-position">(Row: {{ widget.position.row + 1 }}, Col: {{ widget.position.col + 1 }})</span>
          </div>
        </div>

        <!-- Resize Handles -->
        <div class="resize-handle resize-n" (mousedown)="onResizeStart($event, widget, 'n')" title="Resize top"></div>
        <div class="resize-handle resize-s" (mousedown)="onResizeStart($event, widget, 's')" title="Resize bottom"></div>
        <div class="resize-handle resize-e" (mousedown)="onResizeStart($event, widget, 'e')" title="Resize right"></div>
        <div class="resize-handle resize-w" (mousedown)="onResizeStart($event, widget, 'w')" title="Resize left"></div>
        <div class="resize-handle resize-nw" (mousedown)="onResizeStart($event, widget, 'nw')" title="Resize top-left"></div>
        <div class="resize-handle resize-ne" (mousedown)="onResizeStart($event, widget, 'ne')" title="Resize top-right"></div>
        <div class="resize-handle resize-sw" (mousedown)="onResizeStart($event, widget, 'sw')" title="Resize bottom-left"></div>
        <div class="resize-handle resize-se" (mousedown)="onResizeStart($event, widget, 'se')" title="Resize bottom-right"></div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="widgets.length === 0">
      <div class="empty-icon">ğŸ“¦</div>
      <h3>No Widgets</h3>
      <p>Click "Add Widget" to add your first widget to the grid</p>
    </div>
  </div>

  <!-- Help Text -->
  <div class="help-section">
    <h3>ğŸ’¡ Tips</h3>
    <ul>
      <li><strong>Drag:</strong> Click and hold the header to move widgets around the grid</li>
      <li><strong>Resize:</strong> Drag the corners or edges to resize widgets</li>
      <li><strong>Snap to Grid:</strong> Widgets automatically snap to the nearest grid cell</li>
      <li><strong>Templates:</strong> Apply pre-designed layouts instantly</li>
      <li><strong>Grid Overlay:</strong> Toggle to see/hide the grid lines</li>
    </ul>
  </div>
</div>
